<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <style>
        .container {
            max-width: 600px;
        }

        h1,
        h2,
        p {
            text-align: center;
        }

        [box-id] {
            /* width: 80px; */
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
            transition: 0.3s;
        }

        [box-x] {
            /* width: 80px; */
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: none;
            transition: 0.3s;
        }

        [box-id].active {
            border: solid 5px red;
            box-shadow: 0 0 20px red;
            transition: 0s;
        }

        [box-x].active {
            border: solid 5px blue;
            box-shadow: 0 0 20px blue;
            transition: 0s;
        }

        .btn-group {
            display: flex;
            justify-content: center;
        }
    </style>
    <title>喜從天降</title>
</head>

<body>
    <h1>喜從天降</h1>
    <h2>按下開始進行遊戲</h2>
    <p>玩法:按下移動按鈕控制底部方塊左右，當上方方塊掉落時碰到底部方塊，即得分!!</p>

    <div class="container">
        <div class="row">
            <div box-x="1" box-y="1" id="11" class="col-1"></div>
            <div box-x="2" box-y="1" id="21" class="col-1"></div>
            <div box-x="3" box-y="1" id="31" class="col-1"></div>
            <div box-x="4" box-y="1" id="41" class="col-1"></div>
            <div box-x="5" box-y="1" id="51" class="col-1"></div>
            <div box-x="6" box-y="1" id="61" class="col-1"></div>
            <div box-x="7" box-y="1" id="71" class="col-1"></div>
            <div box-x="8" box-y="1" id="81" class="col-1"></div>
            <div box-x="9" box-y="1" id="91" class="col-1"></div>
            <div box-x="10" box-y="1" id="101" class="col-1"></div>
            <div box-x="11" box-y="1" id="111" class="col-1"></div>
            <div box-x="12" box-y="1" id="121" class="col-1"></div>
        </div>
        <div class="row">
            <div box-x="1" box-y="2" id="12" class="col-1"></div>
            <div box-x="2" box-y="2" id="22" class="col-1"></div>
            <div box-x="3" box-y="2" id="32" class="col-1"></div>
            <div box-x="4" box-y="2" id="42" class="col-1"></div>
            <div box-x="5" box-y="2" id="52" class="col-1"></div>
            <div box-x="6" box-y="2" id="62" class="col-1"></div>
            <div box-x="7" box-y="2" id="72" class="col-1"></div>
            <div box-x="8" box-y="2" id="82" class="col-1"></div>
            <div box-x="9" box-y="2" id="92" class="col-1"></div>
            <div box-x="10" box-y="2" id="102" class="col-1"></div>
            <div box-x="11" box-y="2" id="112" class="col-1"></div>
            <div box-x="12" box-y="2" id="122" class="col-1"></div>
        </div>
        <div class="row">
            <div box-x="1" box-y="3" id="13" class="col-1"></div>
            <div box-x="2" box-y="3" id="23" class="col-1"></div>
            <div box-x="3" box-y="3" id="33" class="col-1"></div>
            <div box-x="4" box-y="3" id="43" class="col-1"></div>
            <div box-x="5" box-y="3" id="53" class="col-1"></div>
            <div box-x="6" box-y="3" id="63" class="col-1"></div>
            <div box-x="7" box-y="3" id="73" class="col-1"></div>
            <div box-x="8" box-y="3" id="83" class="col-1"></div>
            <div box-x="9" box-y="3" id="93" class="col-1"></div>
            <div box-x="10" box-y="3" id="103" class="col-1"></div>
            <div box-x="11" box-y="3" id="113" class="col-1"></div>
            <div box-x="12" box-y="3" id="123" class="col-1"></div>
        </div>
        <div class="row">
            <div box-x="1" box-y="4" id="14" class="col-1"></div>
            <div box-x="2" box-y="4" id="24" class="col-1"></div>
            <div box-x="3" box-y="4" id="34" class="col-1"></div>
            <div box-x="4" box-y="4" id="44" class="col-1"></div>
            <div box-x="5" box-y="4" id="54" class="col-1"></div>
            <div box-x="6" box-y="4" id="64" class="col-1"></div>
            <div box-x="7" box-y="4" id="74" class="col-1"></div>
            <div box-x="8" box-y="4" id="84" class="col-1"></div>
            <div box-x="9" box-y="4" id="94" class="col-1"></div>
            <div box-x="10" box-y="4" id="104" class="col-1"></div>
            <div box-x="11" box-y="4" id="114" class="col-1"></div>
            <div box-x="12" box-y="4" id="124" class="col-1"></div>
        </div>
        <div class="row">
            <div box-x="1" box-y="5" id="15" class="col-1"></div>
            <div box-x="2" box-y="5" id="25" class="col-1"></div>
            <div box-x="3" box-y="5" id="35" class="col-1"></div>
            <div box-x="4" box-y="5" id="45" class="col-1"></div>
            <div box-x="5" box-y="5" id="55" class="col-1"></div>
            <div box-x="6" box-y="5" id="65" class="col-1"></div>
            <div box-x="7" box-y="5" id="75" class="col-1"></div>
            <div box-x="8" box-y="5" id="85" class="col-1"></div>
            <div box-x="9" box-y="5" id="95" class="col-1"></div>
            <div box-x="10" box-y="5" id="105" class="col-1"></div>
            <div box-x="11" box-y="5" id="115" class="col-1"></div>
            <div box-x="12" box-y="5" id="125" class="col-1"></div>
        </div>
        <div class="row">
            <div box-x="1" box-y="6" id="16" class="col-1"></div>
            <div box-x="2" box-y="6" id="26" class="col-1"></div>
            <div box-x="3" box-y="6" id="36" class="col-1"></div>
            <div box-x="4" box-y="6" id="46" class="col-1"></div>
            <div box-x="5" box-y="6" id="56" class="col-1"></div>
            <div box-x="6" box-y="6" id="66" class="col-1"></div>
            <div box-x="7" box-y="6" id="76" class="col-1"></div>
            <div box-x="8" box-y="6" id="86" class="col-1"></div>
            <div box-x="9" box-y="6" id="96" class="col-1"></div>
            <div box-x="10" box-y="6" id="106" class="col-1"></div>
            <div box-x="11" box-y="6" id="116" class="col-1"></div>
            <div box-x="12" box-y="6" id="126" class="col-1"></div>
        </div>
        <div class="row">
            <div box-x="1" box-y="7" id="17" class="col-1"></div>
            <div box-x="2" box-y="7" id="27" class="col-1"></div>
            <div box-x="3" box-y="7" id="37" class="col-1"></div>
            <div box-x="4" box-y="7" id="47" class="col-1"></div>
            <div box-x="5" box-y="7" id="57" class="col-1"></div>
            <div box-x="6" box-y="7" id="67" class="col-1"></div>
            <div box-x="7" box-y="7" id="77" class="col-1"></div>
            <div box-x="8" box-y="7" id="87" class="col-1"></div>
            <div box-x="9" box-y="7" id="97" class="col-1"></div>
            <div box-x="10" box-y="7" id="107" class="col-1"></div>
            <div box-x="11" box-y="7" id="117" class="col-1"></div>
            <div box-x="12" box-y="7" id="127" class="col-1"></div>
        </div>
        <div class="row">
            <div box-x="1" box-y="8" id="18" class="col-1"></div>
            <div box-x="2" box-y="8" id="28" class="col-1"></div>
            <div box-x="3" box-y="8" id="38" class="col-1"></div>
            <div box-x="4" box-y="8" id="48" class="col-1"></div>
            <div box-x="5" box-y="8" id="58" class="col-1"></div>
            <div box-x="6" box-y="8" id="68" class="col-1"></div>
            <div box-x="7" box-y="8" id="78" class="col-1"></div>
            <div box-x="8" box-y="8" id="88" class="col-1"></div>
            <div box-x="9" box-y="8" id="98" class="col-1"></div>
            <div box-x="10" box-y="8" id="108" class="col-1"></div>
            <div box-x="11" box-y="8" id="118" class="col-1"></div>
            <div box-x="12" box-y="8" id="128" class="col-1"></div>
        </div>
        <div class="row">
            <div box-x="1" box-y="9" id="19" class="col-1"></div>
            <div box-x="2" box-y="9" id="29" class="col-1"></div>
            <div box-x="3" box-y="9" id="39" class="col-1"></div>
            <div box-x="4" box-y="9" id="49" class="col-1"></div>
            <div box-x="5" box-y="9" id="59" class="col-1"></div>
            <div box-x="6" box-y="9" id="69" class="col-1"></div>
            <div box-x="7" box-y="9" id="79" class="col-1"></div>
            <div box-x="8" box-y="9" id="89" class="col-1"></div>
            <div box-x="9" box-y="9" id="99" class="col-1"></div>
            <div box-x="10" box-y="9" id="109" class="col-1"></div>
            <div box-x="11" box-y="9" id="119" class="col-1"></div>
            <div box-x="12" box-y="9" id="129" class="col-1"></div>
        </div>
        <div class="row">
            <div box-id="1" class="col-1"></div>
            <div box-id="2" class="col-1"></div>
            <div box-id="3" class="col-1"></div>
            <div box-id="4" class="col-1"></div>
            <div box-id="5" class="col-1"></div>
            <div box-id="6" class="col-1"></div>
            <div box-id="7" class="col-1"></div>
            <div box-id="8" class="col-1"></div>
            <div box-id="9" class="col-1"></div>
            <div box-id="10" class="col-1"></div>
            <div box-id="11" class="col-1"></div>
            <div box-id="12" class="col-1"></div>
        </div>
    </div>

    <div class="btn-group">
        <button id="l-btn">向左移動</button>
        <button id="s-btn">開始</button>
        <button id="r-btn">向右移動</button>
    </div>

    <!-- Optional JavaScript; choose one of the two! -->
    <script>

        let current = 6
        let score = 0
        let numX = 3
        let timer
        let arrX
        let currentX
        let currenty
        let gameBoxs
        const gameTime = 60
        const speed = 500

        const sbtn = document.querySelector('#s-btn')
        const lbtn = document.querySelector('#l-btn')
        const rbtn = document.querySelector('#r-btn')
        const h2 = document.querySelector('h2')
        const p = document.querySelector('p')
        let boxs = document.querySelectorAll('[box-id]')


        window.onload = function () {

            sbtn.addEventListener('click', () => {
                start()
                randomX()
                down()
            })

            lbtn.addEventListener('click', () => {
                move(-1)
            })

            rbtn.addEventListener('click', () => {
                move(1)
            })

        }

        function start() {
            let active = document.querySelectorAll('.active')
            console.log(active)
            if (active.length != 0) {
                clear()
            }

            current = 6
            score = 0
            arrX = []
            boxs[current].classList.add('active')
            p.innerText = ""

        }

        function clear() {
            boxs[current].classList.remove('active')
            gameBoxs.forEach((Id, index) => {
                gameBox = document.getElementById(`${Id.x}${Id.y}`)
                gameBox.classList.remove('active')
            })
            clearInterval(timer)
        }

        function clearBox() {
            gameBoxs.forEach((Id, index) => {
                gameBox = document.getElementById(`${Id.x}${Id.y}`)
                gameBox.classList.remove('active')
            })
        }

        function randomX() {
            let json = {}

            while (arrX.length < numX) {
                let k = Math.round(Math.random() * 11)
                if (!json[k]) {
                    json[k] = true
                    arrX.push(k)
                }
            }
            gameBoxs = arrX.map((x, index) => {
                console.log(x)
                return {
                    x: x + 1,
                    y: 1
                }
            })
            gameBoxs.forEach(Id => {
                gameBox = document.getElementById(`${Id.x}${Id.y}`)
                gameBox.classList.add('active')
                console.log(gameBox)

            });
            arrX = []
        }


        function down() {


            let times = 1


            timer = setInterval(() => {
                gameBoxs.forEach((Id, index) => {
                    gameBox = document.getElementById(`${Id.x}${Id.y}`)
                    gameBox.classList.remove('active')

                    if (times == 90) {
                        clearInterval(timer)
                    }
                    else if (Id.y == 9) {
                        if (Id.x == current + 1) {
                            score++
                        }
                        Id.x = Math.round(Math.random() * 11) + 1
                        Id.y = 1
                        console.log(Id.x)
                        gameBox = document.getElementById(`${Id.x}1`)
                        gameBox.classList.add('active')

                    }
                    else {
                        Id.y = Id.y + 1
                        gameBox = document.getElementById(`${Id.x}${Id.y}`)
                        gameBox.classList.add('active')
                    }
                })
                // console.log(`剩下${(gameTime - times) * (speed / 1000)}秒，${score}分`)
                if (times == 90) {
                    h2.innerText = `遊戲結束，共得${score}分`
                }
                else {
                    h2.innerText = `剩下${(90 - times) * (speed / 1000)}秒，${score}分`
                }
                times++
            }, 500)
        }

        function move(step) {

            if (current <= boxs.length - 1 && current >= 0) {

                boxs[current].classList.remove('active')

                if (current == boxs.length - 1 && step == 1) {
                    current = current
                }
                else if (current == 0 && step == -1) {
                    current = current
                } else {
                    current = current + step
                }
                boxs[current].classList.add('active')
            }
        }


    </script>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->
</body>

</html>